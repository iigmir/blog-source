# 北七，Vue 不會看 DOM 屬性啦！

我腦袋枯竭，不想寫文章……怎麼了？

總之，當你想觀察 Vue 內部的 DOM 屬性時，你可能會這麼寫：

```vue
<template>
    <main>
        <nav ref="foo">
            <!-- DOMs -->
        </nav>
    </main>
</template>

<script>
export default {
    watch: {
        "$refs.foo"(newval) {
            // Do something...
        },
    },
}
</script>
```

**這麼做會失敗。**因為 Vue 的響應式原理是 [Object.defineProperty](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)，沒有實做到 DOM 的層面。

那麼該怎麼做？答案是使用[MutationObserver](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver)──這個 API 可以追蹤特定的 DOM 更動，並提供該 DOM 具體的資訊。

你需要丟幾個東西給 `MutationObserver`：

1. 目標 DOM。
2. 監聽時的動作。
3. 設定。

所以我們試試看這樣：

```vue
<template>
    <main>
        <nav ref="foo">
            <!-- DOMs -->
        </nav>
    </main>
</template>

<script>
export default {
    data() {
        return { observer: null, };
    },
    methods: {
        change_it() { this.flag = !this.flag; },
        active_observer() {
            const callback = (mutationsList, observer) => {
                // Do actions...
            };
            const dom = this.$refs.foo;
            const cfg = { attributes: true, childList: true, subtree: true };
            this.observer = new MutationObserver( callback );
            this.observer.observe( dom, cfg );
        }
    },
    mounted() {
        this.active_observer();
    },
    beforeDestroy() {
        if( this.observer ) {
            this.observer.disconnect();
        }
    },
};
</script>
```

記住，觀察 DOM 只能放在 `mounted` 裡面。

這樣做看似成功了，但有一個問題……
